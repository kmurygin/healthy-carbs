<header>
  <nav aria-label="Primary" class="mx-auto flex max-w-7xl items-center justify-between p-4 sm:p-6 lg:px-4">
    <a
      [routerLink]="['/']"
      class="group inline-flex items-center gap-2
      focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded-md"
    >
      <span
        class="text-2xl sm:text-3xl lg:text-4xl font-extrabold tracking-tight
        text-emerald-900 transition-colors duration-200 group-hover:text-gray-800"
      >
        Healthy <span class="text-emerald-600 group-hover:text-gray-800 ">Carbs</span>
      </span>
      <span class="sr-only">Homepage</span>
    </a>

    <button
      (click)="openMenu()"
      [attr.aria-expanded]="menuOpen() ? 'true' : 'false'"
      aria-controls="mobile-menu"
      aria-label="Open menu"
      class="-m-2.5 inline-flex items-center justify-center rounded-md p-2.5 text-gray-700 lg:hidden
      focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 hover:cursor-pointer"
      type="button"
    >
      <i aria-hidden="true" class="fa-solid fa-bars text-2xl"></i>
    </button>

    <div class="hidden lg:flex lg:items-center lg:gap-x-10">
      @if (isLoggedIn()) {
        @for (item of navItems; track item.path) {
          <a
            [routerLink]="item.path"
            class="text-sm font-semibold text-gray-900 hover:text-emerald-800
            focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded"
            routerLinkActive="text-emerald-700 font-bold"
          >
            {{ item.label }}
          </a>
        }
      }

      @if (!isLoggedIn()) {
        <a
          class="text-sm font-semibold text-gray-900 hover:text-emerald-800
          focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded"
          routerLink="/login"
          routerLinkActive="text-emerald-700 font-bold"
        >
          Sign in
        </a>
        <a
          class="text-sm font-semibold text-emerald-800 hover:text-emerald-700
          focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded"
          routerLink="/register"
          routerLinkActive="text-emerald-700 font-bold"
        >
          Sign up
        </a>
      } @else {
        @if (isAdminOrDietitian()) {
          <a
            class="text-sm font-semibold text-gray-900 hover:text-emerald-800
            focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded"
            routerLink="/admin"
            routerLinkActive="text-emerald-700 font-bold"
          >
            {{ userRole() === UserRole.ADMIN ? 'Admin' : 'Dietitian' }} Panel
          </a>
        }
        <a
          class="inline-flex items-center gap-2 text-sm font-semibold text-emerald-800 hover:text-emerald-700
          focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded"
          routerLink="/user"
          routerLinkActive="text-emerald-700 font-bold"
        >
          <div
            class="relative h-7 w-7 overflow-hidden rounded-full border-2 border-emerald-800 shadow-md bg-gray-100"
          >
            <img
              [alt]="'Profile picture of ' + username()"
              [ngSrc]="displayImageSrc()"
              class="h-full w-full object-cover"
              height="28"
              loading="lazy"
              width="28"
            />
            @if (isImageLoading()) {
              <div class="absolute inset-0 rounded-full bg-gray-100 animate-pulse"></div>
            }
          </div>
          <span>{{ username() }}</span>
        </a>
        <button
          (click)="logout()"
          class="text-sm font-semibold text-gray-900 hover:text-emerald-800
          focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded
          hover:cursor-pointer"
          type="button"
        >
          Logout
        </button>
      }
    </div>

  </nav>

  <app-mobile-menu
    #mobileMenu
    (logoutRequested)="logout()"
    (menuClosed)="onMenuClosed()"
    [displayImageSrc]="displayImageSrc()"
    [isAdminOrDietitian]="isAdminOrDietitian()"
    [isImageLoading]="isImageLoading()"
    [isLoggedIn]="isLoggedIn()"
    [navItems]="navItems"
    [userRole]="userRole()"
    [username]="username()"
  />
</header>
