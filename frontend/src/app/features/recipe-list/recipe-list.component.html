<section class="mx-auto max-w-7xl px-4 py-0">
  <h1 class="text-3xl font-bold mb-4">Recipes</h1>

  <form (submit)="$event.preventDefault()" class="mb-6 grid grid-cols-1 gap-3 sm:grid-cols-4" role="search">
    <label class="flex flex-col">
      <span class="text-sm font-medium mb-1">Search by name</span>
      <input
        (input)="updateFilter('name', $event)"
        aria-label="Search recipes by name"
        class="rounded-xl border px-3 py-2"
        placeholder="e.g. risotto"
        type="search"
      />
    </label>

    <label class="flex flex-col">
      <span class="text-sm font-medium mb-1">Search by ingredient</span>
      <input
        (input)="updateFilter('ingredient', $event)"
        aria-label="Search recipes by ingredient"
        class="rounded-xl border px-3 py-2"
        placeholder="e.g. tomato"
        type="search"
      />
    </label>

    <label class="flex flex-col">
      <span class="text-sm font-medium mb-1">Diet type</span>
      <select (change)="updateFilter('diet', $event)" class="rounded-xl border px-3 py-2">
        <option value="">All</option>
        @for (dietType of dietTypes(); track dietType) {
          <option [value]="dietType">{{ dietType }}</option>
        }
      </select>
    </label>

    <label class="flex flex-col">
      <span class="text-sm font-medium mb-1">Meal type</span>
      <select (change)="updateFilter('meal', $event)" class="rounded-xl border px-3 py-2">
        <option value="">All</option>
        @for (mealType of mealTypes(); track mealType) {
          <option [value]="mealType">{{ mealType }}</option>
        }
      </select>
    </label>
  </form>

  @if (filtered().length === 0) {
    <p>No recipes match your filters.</p>
  } @else {

    <div class="mb-3 flex items-center justify-between gap-3">
      <p class="text-sm text-gray-600">
        Showing <span class="font-medium">{{ startIndex() + 1 }}</span>–
        <span class="font-medium">{{ endIndex() }}</span> of
        <span class="font-medium">{{ total() }}</span>
      </p>

      <label class="text-sm flex items-center gap-2">
        <span class="font-medium">Recipes per page:</span>
        <select (change)="onPageSizeChange($event)" class="rounded-lg border px-2 py-1">
          @for (pageSizeOption of pageSizeOptions; track pageSizeOption) {
            <option [selected]="pageSizeOption === pageSize()" [value]="pageSizeOption">{{ pageSizeOption }}</option>
          }
        </select>
      </label>
    </div>

    <ul aria-label="Recipe list" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4">
      @for (recipe of pageItems(); track recipe.id) {
        <li
          [class.hover:bg-gray-100]="recipe.dietType !== 'VEGAN' && recipe.dietType !== 'VEGETARIAN'"
          [class.hover:bg-green-200]="recipe.dietType === 'VEGAN' || recipe.dietType === 'VEGETARIAN'"
          class="rounded-2xl border shadow-sm p-4 transition-colors"
        >
          <a
            [routerLink]="['/recipes', recipe.id]"
            class="block focus:outline-none focus-visible:ring-2 focus-visible:ring-emerald-600 rounded-xl"
          >
            <h2 class="text-lg font-semibold mb-2">{{ recipe.name }}</h2>
            <p class="text-sm mb-2">
              <span
                [class.text-gray-700]="recipe.dietType !== 'VEGAN' && recipe.dietType !== 'VEGETARIAN'"
                [class.text-green-600]="recipe.dietType === 'VEGAN' || recipe.dietType === 'VEGETARIAN'"
                class="font-medium"
              >
                {{ recipe.dietType }}
              </span>
              • <span class="text-gray-600">{{ recipe.mealType }}</span>
            </p>
            <div class="text-sm text-gray-700 space-y-1">
              <div><span class="font-medium">kcal:</span> {{ recipe.calories }}</div>
              <div><span class="font-medium">Carbs:</span> {{ recipe.carbs }} g</div>
              <div><span class="font-medium">Protein:</span> {{ recipe.protein }} g</div>
              <div><span class="font-medium">Fat:</span> {{ recipe.fat }} g</div>
            </div>
          </a>
        </li>
      }
    </ul>

    <div class="mt-6 flex items-center justify-center gap-2">
      <button (click)="prevPage()" [disabled]="page() <= 1" aria-label="Previous page"
              class="rounded-xl border px-3 py-1 cursor-pointer hover:bg-gray-300 disabled:opacity-50">
        ‹ Prev
      </button>

      <span class="px-2 text-sm">
        Page <span class="font-medium">{{ page() }}</span> / {{ totalPages() }}
      </span>

      <button (click)="nextPage()" [disabled]="page() >= totalPages()" aria-label="Next page"
              class="rounded-xl border px-3 py-1 cursor-pointer hover:bg-gray-300 disabled:opacity-50">
        Next ›
      </button>
    </div>
  }
</section>
