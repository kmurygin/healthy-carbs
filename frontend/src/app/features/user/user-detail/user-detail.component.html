<div class="max-w-md mx-auto rounded-lg bg-white p-8 shadow-sm">
  <h2 class="mb-6 text-center text-2xl font-semibold text-emerald-700">
    Personal Information
  </h2>

  <div class="mb-8 flex flex-col items-center">
    <div class="relative group h-32 w-32">
      <div
        class="h-full w-full overflow-hidden rounded-full border-4 border-emerald-50 shadow-md bg-gray-100"
      >
        <img
          [ngSrc]="displayImageSrc()"
          alt="User profile picture"
          class="h-full w-full object-cover"
          loading="eager"
          width="128"
          height="128"
        />
      </div>

      @if (isUploading()) {
        <div class="absolute inset-0 flex items-center justify-center rounded-full bg-black/50 z-10">
          <i class="fa-solid fa-spinner fa-spin text-white text-2xl"></i>
        </div>
      }

      @if (isImageLoading()) {
        <div class="absolute inset-0 rounded-full bg-gray-100 animate-pulse"></div>
      }

      <button
        (click)="triggerFileInput()"
        [disabled]="isUploading()"
        aria-label="Upload new profile picture"
        class="absolute bottom-0 right-0 flex h-10 w-10 cursor-pointer items-center justify-center
        rounded-full bg-emerald-600 text-white shadow-lg transition-transform
        hover:bg-emerald-700 hover:scale-105
        focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2
        disabled:opacity-50 disabled:cursor-not-allowed"
        type="button"
      >
        <i aria-hidden="true" class="fa-solid fa-camera text-sm"></i>
      </button>

      <input
        #fileInput
        (change)="onFileSelected($event)"
        accept="image/png, image/jpeg, image/jpg"
        aria-label="Select profile picture"
        class="hidden"
        type="file"
      />
    </div>
    <p class="mt-2 text-xs text-gray-500">Allowed *.jpeg, *.jpg, *.png, max 5MB</p>
  </div>

  <form (ngSubmit)="onSubmit()" [formGroup]="formGroup" class="space-y-6" novalidate>

    <div>
      <label class="mb-1 block text-sm font-medium text-gray-700" for="firstName">First Name</label>
      <input
        [attr.aria-invalid]="formGroup.controls.firstName.invalid && formGroup.controls.firstName.touched"
        class="input"
        formControlName="firstName"
        id="firstName"
        type="text"
      />
      @if (formGroup.controls.firstName.touched && formGroup.controls.firstName.errors; as errors) {
        <div class="text-red-500 text-xs mt-1">
          @if (errors['required']) {
            <span>First name is required</span>
          }
          @if (errors['pattern']) {
            <span>First name must contain only letters</span>
          }
        </div>
      }
    </div>

    <div>
      <label class="mb-1 block text-sm font-medium text-gray-700" for="lastName">Last Name</label>
      <input
        [attr.aria-invalid]="formGroup.controls.lastName.invalid && formGroup.controls.lastName.touched"
        class="input"
        formControlName="lastName"
        id="lastName"
        type="text"
      />
      @if (formGroup.controls.lastName.touched && formGroup.controls.lastName.errors; as errors) {
        <div class="text-red-500 text-xs mt-1">
          @if (errors['required']) {
            <span>Last name is required</span>
          }
          @if (errors['pattern']) {
            <span>Last name must contain only letters</span>
          }
        </div>
      }
    </div>

    <div>
      <label class="mb-1 block text-sm font-medium text-gray-700" for="email">Email</label>
      <input
        [attr.aria-invalid]="formGroup.controls.email.invalid && formGroup.controls.email.touched"
        class="input"
        formControlName="email"
        id="email"
        type="email"
      />
      @if (formGroup.controls.email.touched && formGroup.controls.email.errors; as errors) {
        <div class="text-red-500 text-xs mt-1">
          @if (errors['required']) {
            <span>Email is required</span>
          }
          @if (errors['email']) {
            <span>Enter a valid email address</span>
          }
        </div>
      }
    </div>

    <button
      [disabled]="formGroup.invalid || isUploading()"
      class="w-full flex items-center justify-center gap-2 rounded-md bg-emerald-600 px-4 py-2
             text-white text-sm font-medium transition hover:bg-emerald-700 disabled:opacity-50
             disabled:pointer-events-none focus:outline-none focus:ring-2 focus:ring-emerald-500 focus:ring-offset-2"
      type="submit"
    >
      Update personal information
    </button>

    @if (errorMessage()) {
      <app-error-message [message]="errorMessage()"></app-error-message>
    }

    @if (infoMessage()) {
      <app-info-message [message]="infoMessage()"></app-info-message>
    }
  </form>
</div>
