<section class="mx-auto max-w-7xl px-4 py-2">
  @if (isLoading()) {
    <div class="text-3xl font-bold tracking-tight text-gray-900 leading-tight text-center p-16">
      <i class="fa-solid fa-spinner fa-spin"></i>
      Loading, please wait...
    </div>
  } @else if (errorMessage()) {
    <app-error-message [message]="errorMessage()!"/>
  } @else if (!recipe()) {
    <app-error-message message="Recipe not found"/>
  } @else {

    @let selectedRecipe = recipe()!;

    <div class="mt-3 p-6 flex flex-col-reverse sm:flex-row sm:items-start sm:justify-between gap-4">

      <div>
        <div class="flex items-center gap-4 mt-2">

          <h1 class="text-3xl font-bold">{{ selectedRecipe.name }}</h1>

          <button
            (click)="toggleFavourite()"
            [attr.aria-label]="selectedRecipe.isFavourite ? 'Remove from favourites' : 'Add to favourites'"
            [title]="selectedRecipe.isFavourite ? 'Remove from favourites' : 'Add to favourites'"
            class="text-2xl transition-transform duration-200 hover:scale-125 hover:cursor-pointer"
            type="button"
          >
            @if (selectedRecipe.isFavourite) {
              <i class="fa-solid fa-star text-yellow-400"></i>
            } @else {
              <i class="fa-regular fa-star text-gray-400 hover:text-yellow-400"></i>
            }
          </button>
        </div>

        @if (selectedRecipe.description) {
          <p class="text-gray-700 mt-2 text-lg">{{ selectedRecipe.description }}</p>
        }
      </div>

      <a
        class="inline-flex items-center gap-2 rounded-xl bg-gray-100 px-3 py-1.5 text-sm font-medium
        text-gray-800 hover:bg-gray-200 flex-shrink-0 self-start"
        routerLink="/recipes"
      >
        <i class="fa-solid fa-arrow-left"></i>
        Back to recipes list
      </a>
    </div>

    <div class="px-6 pb-6">
      <div class="mt-0 flex flex-wrap gap-2">
        <span [class]="dietTagClasses()">
          <i [class]="dietIconClasses()"></i>
          {{ selectedRecipe.dietType }}
        </span>
        <span [class]="mealTagClasses()">
          <i class="fa-solid fa-plate-wheat"></i>
          {{ selectedRecipe.mealType }}
        </span>
      </div>

      <div class="mt-3 border-t border-gray-200 pt-4">
        <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm mt-3">

          @for (macro of macros(); track macro.name) {
            <div class="flex items-center gap-1">
              <i class="fa-solid {{ macro.icon }} {{ macro.color }}"></i>
              <span class="text-gray-600">{{ macro.name }}</span>
              <span class="font-semibold text-gray-900">
                {{ macro.value | number: '1.0-0' }} {{ macro.unit }}
              </span>
            </div>
          }

        </div>
      </div>

      <div class="mt-6 border-t border-gray-200 pt-6 grid grid-cols-1 lg:grid-cols-6 gap-8">

        <div class="lg:col-span-2">
          <h2 class="text-xl font-semibold flex items-center gap-2">
            <i class="fa-solid fa-carrot text-gray-400"></i>
            Ingredients
          </h2>
          <ul class="mt-3 space-y-2">
            @for (recipeIngredient of selectedRecipe.ingredients; track recipeIngredient.id) {
              <li class="flex justify-between items-baseline gap-4 py-1 border-b border-gray-100">
                <span class="text-gray-800">
                  {{ recipeIngredient.ingredient.name }}
                </span>
                <span class="text-gray-600 text-right flex-shrink-0">
                  {{ recipeIngredient.quantity | number: '1.0-2' }}
                  @if (recipeIngredient.ingredient.unit) {
                    {{ recipeIngredient.ingredient.unit }}s
                  } @else {
                    items
                  }
                </span>
              </li>
            }
          </ul>
        </div>

        @if (selectedRecipe.instructions) {
          <div class="lg:col-span-4">
            <h5 class="text-xl font-semibold text-gray-900 flex items-center gap-2">
              <i class="fa-solid fa-list-check text-gray-400"></i>
              Instructions
            </h5>
            <p class="mt-2 text-base text-gray-700 whitespace-pre-line">
              {{ selectedRecipe.instructions }}
            </p>
          </div>
        }
      </div>
    </div>
  }
</section>
